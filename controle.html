<html><head><base href="/controle.html">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Controle Financeiro | Dashboard</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
<link href="https://cdn.jsdelivr.net/npm/apexcharts@3.40.0/dist/apexcharts.css" rel="stylesheet">
<link href="https://cdn.datatables.net/1.10.24/css/jquery.dataTables.min.css" rel="stylesheet"/>

<style>
:root {
  --primary: #fe2c55;
  --secondary: #25f4ee; 
  --dark: #121212;
  --light: #ffffff;
  --sidebar-width: 250px;
  --bg-card: rgba(255,255,255,0.05);
  --border-card: rgba(255,255,255,0.1);
  --hover-card: rgba(255,255,255,0.08);
}

[data-theme="light"] {
  --dark: #ffffff;
  --light: #121212;
  --bg-card: rgba(0,0,0,0.05);
  --border-card: rgba(0,0,0,0.1);
  --hover-card: rgba(0,0,0,0.08);
}

body {
  background: var(--dark);
  color: white;
  font-family: -apple-system, system-ui, BlinkMacSystemFont, "Segoe UI", Roboto, Ubuntu;
  min-height: 100vh;
}

.sidebar {
  width: var(--sidebar-width);
  position: fixed;
  top: 0;
  left: 0;
  height: 100vh;
  background: rgba(18, 18, 18, 0.95);
  border-right: 1px solid rgba(255,255,255,0.1);
  padding: 1.5rem;
  transition: all 0.3s ease;
  z-index: 1000;
}

.main-content {
  margin-left: var(--sidebar-width);
  padding: 2rem;
}

.theme-switch {
  position: fixed;
  top: 20px;
  right: 20px;
  z-index: 1000;
}

.nav-link {
  color: rgba(255,255,255,0.8);
  padding: 0.8rem 1rem;
  border-radius: 10px;
  margin-bottom: 0.5rem;
  transition: all 0.3s ease;
}

.nav-link:hover, .nav-link.active {
  background: rgba(254, 44, 85, 0.1);
  color: var(--primary);
}

.nav-link i {
  width: 20px;
  margin-right: 10px;
}

.control-card {
  background: var(--bg-card);
  border-radius: 15px;
  padding: 1.5rem;
  border: 1px solid var(--border-card);
  transition: transform 0.3s ease;
}

.control-card:hover {
  transform: translateY(-5px);
  background: var(--hover-card);
}

.transaction-form {
  background: var(--bg-card);
  border-radius: 15px;
  padding: 2rem;
  border: 1px solid var(--border-card);
}

.custom-input {
  background: rgba(255,255,255,0.1) !important;
  border: 1px solid rgba(255,255,255,0.2) !important;
  color: white !important;
}

.custom-input:focus {
  background: rgba(255,255,255,0.15) !important;
  border-color: var(--primary) !important;
  box-shadow: 0 0 0 0.25rem rgba(254, 44, 85, 0.25) !important;
}

.custom-select {
  background-color: rgba(255,255,255,0.1) !important;
  border: 1px solid rgba(255,255,255,0.2) !important;
  color: white !important;
}

.transaction-list {
  max-height: 400px;
  overflow-y: auto;
}

.transaction-item {
  background: var(--bg-card);
  border-radius: 10px;
  padding: 1rem;
  margin-bottom: 0.5rem;
  transition: all 0.3s ease;
}

.transaction-item:hover {
  background: rgba(255,255,255,0.1);
  transform: translateX(5px);
}

.btn-gradient {
  background: linear-gradient(45deg, var(--primary), var(--secondary));
  border: none;
  color: white;
}

.btn-gradient:hover {
  opacity: 0.9;
  color: white;
}

.animate-hover {
  transition: all 0.3s ease;
}

.animate-hover:hover {
  transform: translateY(-5px);
  background: var(--hover-card);
}

.gradient-text {
  background: linear-gradient(45deg, var(--primary), var(--secondary));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  font-weight: bold;
}

.main-footer {
  background: var(--dark);
  color: white;
  padding: 2rem 0;
}
</style>
</head>
<body>

<!-- Sidebar -->
<div class="sidebar">
  <div class="d-flex align-items-center mb-4">
    <svg width="32" height="32" viewBox="0 0 32 32" class="me-2">
      <defs>
        <linearGradient id="logo-gradient" x1="0%" y1="0%" x2="100%" y2="100%">
          <stop offset="0%" style="stop-color:var(--primary)"></stop>
          <stop offset="100%" style="stop-color:var(--secondary)"></stop>
        </linearGradient>
      </defs>
      <rect x="4" y="4" width="24" height="24" rx="6" fill="url(#logo-gradient)"></rect>
      <text x="16" y="21" fill="white" font-size="12" text-anchor="middle" font-weight="bold">$</text>
    </svg>
    <span style="font-weight: 800; letter-spacing: -0.5px; font-size: 1.4rem;">
      <span style="color: var(--primary);">Finance</span>
      <span style="font-weight: 300; opacity: 0.9;">Dashboard</span>
    </span>
  </div>

  <nav class="nav flex-column mb-4">
    <a href="index.html" class="nav-link">
      <i class="fas fa-home"></i>Vis√£o Geral
    </a>
    <a href="controle.html" class="nav-link active">
      <i class="fas fa-chart-pie"></i>Controle Financeiro
    </a>
    <a href="dividas.html" class="nav-link">
      <i class="fas fa-file-invoice-dollar"></i>D√≠vidas
    </a>
    <a href="cartoes.html" class="nav-link">
      <i class="fas fa-credit-card"></i>Cart√µes
    </a>
    <a href="investimentos.html" class="nav-link">
      <i class="fas fa-chart-line"></i>Investimentos
    </a>
    <a href="patrimonio.html" class="nav-link">
      <i class="fas fa-building"></i>Patrim√¥nio
    </a>
    <a href="veiculo.html" class="nav-link">
      <i class="fas fa-car"></i>Ve√≠culos
    </a>
    <a href="historico.html" class="nav-link">
      <i class="fas fa-history"></i>Hist√≥rico
    </a>
    <a href="configuracoes.html" class="nav-link">
      <i class="fas fa-cog"></i>Configura√ß√µes
    </a>
  </nav>
</div>

<!-- Main Content -->
<div class="main-content">
  <div class="theme-switch">
    <button id="themeToggle" class="btn btn-outline-light">
      <i class="fas fa-moon dark-icon"></i>
      <i class="fas fa-sun light-icon d-none"></i>
    </button>
  </div>
  
  <h2 class="mb-4">Controle Financeiro</h2>

  <!-- Add Transaction Form -->
  <div class="row mb-4">
    <div class="col-md-12">
      <div class="transaction-form">
        <h4 class="mb-4">Nova Transa√ß√£o</h4>
        <form id="transactionForm">
          <div class="row g-3">
            <div class="col-md-6">
              <label class="form-label">Descri√ß√£o</label>
              <input type="text" class="form-control custom-input" required>
            </div>
            <div class="col-md-3">
              <label class="form-label">Valor</label>
              <input type="number" step="0.01" class="form-control custom-input" required>
            </div>
            <div class="col-md-3">
              <label class="form-label">Data</label>
              <input type="date" class="form-control custom-input" required>
            </div>
            <div class="col-md-4">
              <label class="form-label">Tipo</label>
              <select name="type" class="form-select custom-select">
                <option value="expense">‚§µÔ∏è Despesa</option>
                <option value="income">‚úÖ Receita</option>
              </select>
            </div>
            <div class="col-md-4">
              <label class="form-label">Categoria</label>
              <select name="category" class="form-select custom-select" id="category">
                <optgroup label="Despesas">
                  <option value="moradia">üè† Moradia</option>
                  <option value="compras">üõí Compras</option>
                  <option value="restaurantes">üçΩÔ∏è Restaurantes</option>
                  <option value="viagens">‚úàÔ∏è Viagens</option>
                  <option value="saude">üè• Sa√∫de</option>
                  <option value="transporte">üöç Transporte</option>
                  <option value="cursos">üìö Cursos</option>
                  <option value="jogos">üéÆ Jogos</option>
                  <option value="presentes">üéÅ Presentes</option>
                  <option value="diversao">üéâ Divers√£o</option>
                  <option value="outros">üîÑ Outros</option>
                  <option value="cartao">üí≥ Cart√£o de Cr√©dito</option>
                  <option value="celular">üì± Plano de Celular</option>
                  <option value="faculdade">üéì Faculdade</option>
                  <option value="barbeiro">üíà Barbeiro</option>
                  <option value="beleza">üíÖ Sal√£o de Beleza</option>
                  <option value="spotify">üéµ Spotify</option>
                  <option value="consorcio">ü§ù Cons√≥rcio</option>
                  <option value="streaming">üé¨ Streaming</option>
                  <option value="juridico">‚öñÔ∏è Jur√≠dico</option>
                  <option value="banco">üè¶ Banco</option>
                </optgroup>
                <optgroup label="Receitas">
                  <option value="salario">üí∞ Sal√°rio</option>
                  <option value="uber">üöñ Uber</option>
                  <option value="ferias">üå¥ F√©rias</option>
                  <option value="fgts">üè¢ FGTS</option>
                  <option value="pis">üìà PIS</option>
                  <option value="lucros">üíπ Lucros</option>
                  <option value="servicos">üíª Servi√ßos</option>
                </optgroup>
              </select>
            </div>
            <div class="col-md-4">
              <label class="form-label">M√©todo de Pagamento</label>
              <select name="method" class="form-select custom-select">
                <option value="credit">üí≥ Cart√£o de Cr√©dito</option>
                <option value="debit">üí≥ Cart√£o de D√©bito</option>
                <option value="pix">‚ö° Pix</option>
                <option value="cash">üíµ Dinheiro</option>
                <option value="check">üßæ Cheque</option>
                <option value="deposit">üè¶ Dep√≥sito Banc√°rio</option>
                <option value="crypto">‚Çø Criptomoedas</option>
                <option value="trade">üîÑ Troca</option>
                <option value="bill">üßæ Boleto</option>
              </select>
            </div>
            <div class="col-12">
              <button type="submit" class="btn btn-gradient">
                <i class="fas fa-plus me-2"></i>Adicionar Transa√ß√£o
              </button>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Transactions List -->
  <div class="row">
    <div class="col-md-12">
      <div class="control-card">
        <div class="d-flex justify-content-between align-items-center mb-4">
          <h4 class="mb-0">Transa√ß√µes Recentes</h4>
          <div class="btn-group">
            <button class="btn btn-outline-light btn-sm">
              <i class="fas fa-filter me-2"></i>Filtrar
            </button>
            <button class="btn btn-outline-light btn-sm">
              <i class="fas fa-sort me-2"></i>Ordenar
            </button>
          </div>
        </div>
        
        <div class="table-responsive">
          <table id="transactionsTable" class="table table-dark">
            <thead>
              <tr>
                <th>Data</th>
                <th>Descri√ß√£o</th>
                <th>Categoria</th>
                <th>Valor</th>
                <th>M√©todo</th>
                <th>A√ß√µes</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>2024-01-15</td>
                <td>Supermercado Extra</td>
                <td><span class="badge bg-info">Alimenta√ß√£o</span></td>
                <td class="text-danger">- R$ 450,00</td>
                <td><i class="fas fa-credit-card"></i> Cr√©dito</td>
                <td>
                  <button class="btn btn-sm btn-warning me-1" onclick="editTransaction(this)"><i class="fas fa-edit"></i></button>
                  <button class="btn btn-sm btn-danger"><i class="fas fa-trash"></i></button>
                </td>
              </tr>
              <tr>
                <td>2024-01-14</td>
                <td>Sal√°rio</td>
                <td><span class="badge bg-success">Receita</span></td>
                <td class="text-success">+ R$ 8.500,00</td>
                <td><i class="fas fa-money-bill-wave"></i> PIX</td>
                <td>
                  <button class="btn btn-sm btn-warning me-1" onclick="editTransaction(this)"><i class="fas fa-edit"></i></button>
                  <button class="btn btn-sm btn-danger"><i class="fas fa-trash"></i></button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <!-- Charts Section -->
  <div class="row mt-4">
    <div class="col-md-6 mb-4">
      <div class="control-card">
        <h4>Distribui√ß√£o por Categoria</h4>
        <canvas id="categoryChart"></canvas>
      </div>
    </div>
    <div class="col-md-6 mb-4">
      <div class="control-card">
        <h4>Receitas vs Despesas</h4>
        <canvas id="balanceChart"></canvas>
      </div>
    </div>
    <div class="col-md-12">
      <div class="control-card">
        <h4>Fluxo Financeiro</h4>
        <canvas id="timelineChart"></canvas>
      </div>
    </div>
  </div>

  <!-- Footer with Actions -->
  <footer class="main-footer">
    <div class="container">
      <div class="row">
        <div class="col-12 text-center mb-3">
          <button class="btn btn-outline-light mx-1" onclick="saveData()">
            <i class="fas fa-save"></i> Salvar
          </button>
          <button class="btn btn-outline-light mx-1" onclick="exportPDF()">
            <i class="fas fa-file-pdf"></i> PDF
          </button>
          <button class="btn btn-outline-light mx-1" onclick="exportXLS()">
            <i class="fas fa-file-excel"></i> XLS
          </button>
          <button class="btn btn-outline-light mx-1" onclick="printPage()">
            <i class="fas fa-print"></i> Imprimir
          </button>
          <button class="btn btn-outline-light mx-1" onclick="importBackup()">
            <i class="fas fa-upload"></i> Importar
          </button>
          <button class="btn btn-outline-light mx-1" onclick="exportBackup()">
            <i class="fas fa-download"></i> Exportar
          </button>
        </div>
        <div class="col-12 text-center">
          <p>Desenvolvido por <a href="https://dev.daan" class="gradient-text">dev.daan</a> ¬© 2024</p>
          <small>
            <a href="/privacy">Pol√≠tica de Privacidade</a> |
            <a href="/terms">Termos de Uso</a> |
            <a href="/contact">Contato</a>
          </small>
        </div>
      </div>
    </div>
  </footer>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.datatables.net/1.10.24/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
$(document).ready(function() {
  $('#transactionsTable').DataTable({
    responsive: true,
    language: {
      url: '//cdn.datatables.net/plug-ins/1.10.24/i18n/Portuguese-Brasil.json'
    },
    order: [[0, 'desc']],
    pageLength: 10,
    columnDefs: [{
      targets: -1,
      defaultContent: `
        <button class="btn btn-sm btn-warning me-1" onclick="editTransaction(this)"><i class="fas fa-edit"></i></button>
        <button class="btn btn-sm btn-danger" onclick="deleteTransaction(this)"><i class="fas fa-trash"></i></button>
      `
    }]
  });

  const savedTheme = localStorage.getItem('theme') || 'dark';
  document.documentElement.setAttribute('data-theme', savedTheme);
  updateThemeIcons(savedTheme);

  $('#themeToggle').on('click', toggleTheme);

  $('#transactionForm').on('submit', function(e) {
    e.preventDefault();
    
    const formData = {
      description: $(this).find('input[type="text"]').val(),
      amount: $(this).find('input[type="number"]').val(),
      date: $(this).find('input[type="date"]').val(),
      type: $(this).find('select[name="type"]').val(),
      category: $(this).find('select[name="category"]').val(),
      method: $(this).find('select[name="method"]').val()
    };

    const editIndex = $(this).data('edit-index');
    
    if (typeof editIndex !== 'undefined') {
      updateTransaction(editIndex, formData);
      $(this).removeData('edit-index');
      $(this).find('button[type="submit"]').html('<i class="fas fa-plus me-2"></i>Adicionar Transa√ß√£o');
    } else {
      saveTransaction(formData);
    }

    this.reset();
    showNotification('Transa√ß√£o salva com sucesso!', 'success');
  });

  $(document).on('click', '.btn-danger', function() {
    if(confirm('Tem certeza que deseja excluir esta transa√ß√£o?')) {
      $(this).closest('tr').remove();
      showNotification('Transa√ß√£o exclu√≠da com sucesso!', 'success');
    }
  });

  initializeCharts();
});

function toggleTheme() {
  const theme = localStorage.getItem('theme') === 'light' ? 'dark' : 'light';
  document.documentElement.setAttribute('data-theme', theme);
  localStorage.setItem('theme', theme);
  updateThemeIcons(theme);
}

function updateThemeIcons(theme) {
  if (theme === 'light') {
    document.querySelector('.dark-icon').classList.add('d-none');
    document.querySelector('.light-icon').classList.remove('d-none');
  } else {
    document.querySelector('.light-icon').classList.add('d-none');
    document.querySelector('.dark-icon').classList.remove('d-none');
  }
}

function saveTransaction(transaction) {
  let transactions = JSON.parse(localStorage.getItem('transactions')) || [];
  transactions.push(transaction);
  localStorage.setItem('transactions', JSON.stringify(transactions));
  
  const table = $('#transactionsTable').DataTable();
  const row = [
    transaction.date,
    transaction.description,
    `<span class="badge bg-${transaction.type === 'income' ? 'success' : 'info'}">${transaction.category}</span>`,
    `<span class="text-${transaction.type === 'income' ? 'success' : 'danger'}">${transaction.type === 'income' ? '+' : '-'} R$ ${parseFloat(transaction.amount).toFixed(2)}</span>`,
    `<i class="fas fa-${getMethodIcon(transaction.method)}"></i> ${transaction.method}`,
    `
      <button class="btn btn-sm btn-warning me-1" onclick="editTransaction(this)"><i class="fas fa-edit"></i></button>
      <button class="btn btn-sm btn-danger" onclick="deleteTransaction(this)"><i class="fas fa-trash"></i></button>
    `
  ];
  
  table.row.add(row).draw();
  updateCharts();
}

function editTransaction(element) {
  const row = $(element).closest('tr');
  const data = $('#transactionsTable').DataTable().row(row).data();
  
  const form = $('#transactionForm');
  form.find('input[type="text"]').val(data[1]);
  form.find('input[type="number"]').val(parseAmount(data[3]));
  form.find('input[type="date"]').val(data[0]);
  form.find('select[name="type"]').val(data[3].includes('+') ? 'income' : 'expense');
  form.find('select[name="category"]').val(getCategoryFromBadge(data[2]));
  form.find('select[name="method"]').val(getMethodFromIcon(data[4]));

  form.data('edit-index', row.index());
  form.find('button[type="submit"]').html('<i class="fas fa-check me-2"></i>Atualizar Transa√ß√£o');
  form[0].scrollIntoView({behavior: 'smooth'});
}

function parseAmount(amountText) {
  return parseFloat(amountText.replace(/[^0-9.-]+/g, ''));
}

function getCategoryFromBadge(badgeHtml) {
  const text = $(badgeHtml).text();
  return text.toLowerCase();
}

function getMethodFromIcon(methodHtml) {
  const text = $(methodHtml).text().trim();
  return text.toLowerCase();
}

function updateTransaction(index, transaction) {
  let transactions = JSON.parse(localStorage.getItem('transactions')) || [];
  transactions[index] = transaction;
  localStorage.setItem('transactions', JSON.stringify(transactions));
  
  const table = $('#transactionsTable').DataTable();
  
  const row = [
    transaction.date,
    transaction.description,
    `<span class="badge bg-${transaction.type === 'income' ? 'success' : 'info'}">${transaction.category}</span>`,
    `<span class="text-${transaction.type === 'income' ? 'success' : 'danger'}">${transaction.type === 'income' ? '+' : '-'} R$ ${parseFloat(transaction.amount).toFixed(2)}</span>`,
    `<i class="fas fa-${getMethodIcon(transaction.method)}"></i> ${transaction.method}`,
    `
      <button class="btn btn-sm btn-warning me-1" onclick="editTransaction(this)"><i class="fas fa-edit"></i></button>
      <button class="btn btn-sm btn-danger"><i class="fas fa-trash"></i></button>
    `
  ];
  
  table.row(index).data(row).draw();
  updateCharts();
}

function showNotification(message, type = 'info') {
  const toast = `
    <div class="toast align-items-center text-white bg-${type} border-0" role="alert" aria-live="assertive" aria-atomic="true">
      <div class="d-flex">
        <div class="toast-body">
          ${message}
        </div>
        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
      </div>
    </div>
  `;
  
  const toastContainer = document.createElement('div');
  toastContainer.className = 'position-fixed bottom-0 end-0 p-3';
  toastContainer.innerHTML = toast;
  document.body.appendChild(toastContainer);
  
  const toastElement = new bootstrap.Toast(toastContainer.querySelector('.toast'));
  toastElement.show();
  
  setTimeout(() => toastContainer.remove(), 3000);
}

function loadTransactions() {
  const transactions = JSON.parse(localStorage.getItem('transactions')) || [];
  const table = $('#transactionsTable').DataTable();
  
  transactions.forEach(transaction => {
    const row = [
      transaction.date,
      transaction.description,
      `<span class="badge bg-${transaction.type === 'income' ? 'success' : 'info'}">${transaction.category}</span>`,
      `<span class="text-${transaction.type === 'income' ? 'success' : 'danger'}">${transaction.type === 'income' ? '+' : '-'} R$ ${parseFloat(transaction.amount).toFixed(2)}</span>`,
      `<i class="fas fa-${getMethodIcon(transaction.method)}"></i> ${transaction.method}`,
      `
        <button class="btn btn-sm btn-warning me-1" onclick="editTransaction(this)"><i class="fas fa-edit"></i></button>
        <button class="btn btn-sm btn-danger"><i class="fas fa-trash"></i></button>
      `
    ];
    
    table.row.add(row).draw();
  });
}

function getMethodIcon(method) {
  const icons = {
    credit: 'credit-card',
    debit: 'credit-card',
    cash: 'money-bill-wave',
    pix: 'mobile-alt'
  };
  return icons[method] || 'money-bill-wave';
}

let categoryChart, balanceChart, timelineChart;

function initializeCharts() {
  categoryChart = new Chart(document.getElementById('categoryChart'), {
    type: 'doughnut',
    data: {
      labels: [],
      datasets: [{
        data: [],
        backgroundColor: [
          '#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF',
          '#FF9F40', '#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0'
        ]
      }]
    },
    options: {
      responsive: true,
      plugins: {
        legend: {
          position: 'right',
        }
      }
    }
  });

  balanceChart = new Chart(document.getElementById('balanceChart'), {
    type: 'bar',
    data: {
      labels: ['Receitas', 'Despesas'],
      datasets: [{
        data: [0, 0],
        backgroundColor: ['#4BC0C0', '#FF6384']
      }]
    },
    options: {
      responsive: true,
      scales: {
        y: {
          beginAtZero: true
        }
      }
    }
  });

  timelineChart = new Chart(document.getElementById('timelineChart'), {
    type: 'line',
    data: {
      labels: [],
      datasets: [{
        label: 'Saldo',
        data: [],
        borderColor: '#4BC0C0',
        tension: 0.1
      }]
    },
    options: {
      responsive: true,
      scales: {
        y: {
          beginAtZero: true
        }
      }
    }
  });

  loadTransactions();
  updateCharts();
}

function updateCharts() {
  const transactions = JSON.parse(localStorage.getItem('transactions')) || [];
  
  const categories = {};
  transactions.forEach(t => {
    categories[t.category] = (categories[t.category] || 0) + parseFloat(t.amount);
  });
  
  categoryChart.data.labels = Object.keys(categories);
  categoryChart.data.datasets[0].data = Object.values(categories);
  categoryChart.update();

  const totals = transactions.reduce((acc, t) => {
    if (t.type === 'income') {
      acc.income += parseFloat(t.amount);
    } else {
      acc.expense += parseFloat(t.amount);
    }
    return acc;
  }, { income: 0, expense: 0 });

  balanceChart.data.datasets[0].data = [totals.income, totals.expense];
  balanceChart.update();

  const timeline = transactions.sort((a, b) => new Date(a.date) - new Date(b.date));
  let balance = 0;
  const balances = timeline.map(t => {
    balance += t.type === 'income' ? parseFloat(t.amount) : -parseFloat(t.amount);
    return balance;
  });

  timelineChart.data.labels = timeline.map(t => t.date);
  timelineChart.data.datasets[0].data = balances;
  timelineChart.update();
}

loadTransactions();
</script>

</body></html>